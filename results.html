<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù†ØªØ§Ø¦Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

<style>
  body{
    font-family:"Tajawal",sans-serif;
    background:#f6e0f5;
    padding:30px;
    margin:0;
    color:#4a2b5b;
  }

  .wrap{
    max-width:800px;
    margin:auto;
  }

  h1{
    text-align:center;
    font-size:40px;
    font-weight:800;
    color:#7b3bb7;
    margin-bottom:10px;
  }

  p{
    text-align:center;
    color:#7b3bb7;
    font-size:18px;
    margin-top:0;
  }

  .top-buttons{
    display:flex;
    justify-content:center;
    gap:15px;
    margin-top:20px;
  }

  .action-btn{
    background:#7b3bb7;
    color:#fff;
    border:none;
    padding:12px 18px;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
    font-weight:700;
  }

  .action-btn.delete{
    background:#d9534f;
  }

  .card{
    background:#fff;
    border-radius:18px;
    padding:25px;
    box-shadow:0 12px 30px rgba(0,0,0,0.08);
    margin-top:30px;
  }

  .result-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:15px 10px;
    border-bottom:1px solid #eee;
    font-size:20px;
  }

  .result-item:last-child{
    border-bottom:none;
  }

  .badge{
    font-size:26px;
    font-weight:800;
    width:45px;
    text-align:center;
  }

  .score{
    font-weight:900;
    color:#7b3bb7;
    font-size:22px;
  }

  .back-btn{
    display:block;
    width:100%;
    margin-top:25px;
    padding:15px;
    text-align:center;
    background:#7b3bb7;
    color:#fff;
    text-decoration:none;
    border-radius:10px;
    font-size:20px;
    font-weight:700;
  }
</style>
</head>

<body>

<div class="wrap">

  <h1>Ù†ØªØ§Ø¦Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h1>
  <p>ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø­Ø³Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Firebase</p>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© -->
  <div class="top-buttons">
    <button class="action-btn" onclick="refreshPage()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©</button>
    <button class="action-btn delete" onclick="resetScores()">ğŸ—‘ Ø­Ø°Ù Ø§Ù„ØªØµÙˆÙŠØªØ§Øª</button>
  </div>

  <div class="card" id="resultsBox">
    <p style="text-align:center;color:#999;">ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</p>
  </div>

  <a href="index.html" class="back-btn">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</a>

</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDsIVkyv6wEOTBngHKrlZwkiZ8btfU4Onc",
    authDomain: "aisha2-79800.firebaseapp.com",
    projectId: "aisha2-79800",
    storageBucket: "aisha2-79800.firebasestorage.app",
    messagingSenderId: "601958718178",
    appId: "1:601958718178:web:f36c20b70eb259355a9cbb"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  async function loadResults(){
    const box = document.getElementById("resultsBox");
    box.innerHTML = "<p style='text-align:center;color:#999;'>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</p>";

    const snap = await getDocs(collection(db, "groups"));
    let groups = [];

    snap.forEach(doc=>{
      groups.push({
        name: doc.id,
        total: doc.data().total || 0
      });
    });

    groups.sort((a,b)=> b.total - a.total);

    box.innerHTML = "";

    groups.forEach((g, i)=>{
      let medal = "";
      if(i===0) medal = "ğŸ¥‡";
      else if(i===1) medal = "ğŸ¥ˆ";
      else if(i===2) medal = "ğŸ¥‰";
      else medal = `#${i+1}`;

      box.innerHTML += `
        <div class="result-item">
          <div class="badge">${medal}</div>
          <div>${g.name}</div>
          <div class="score">${g.total}</div>
        </div>
      `;
    });
  }

  loadResults();

  // Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
  window.refreshPage = function(){
    location.reload();
  };

  // Ø²Ø± Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·
  window.resetScores = async function(){
    if(!confirm("Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø© Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙˆÙŠØªØ§ØªØŸ â—")) return;

    const snap = await getDocs(collection(db, "groups"));

    for(const d of snap.docs){
      await updateDoc(doc(db, "groups", d.id), { total: 0 });
    }

    alert("ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙˆÙŠØªØ§Øª Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰");
    loadResults();
  };
</script>

</body>
</html>
